function logout(){localStorage.removeItem("adminAuth"),window.location.href="admin.html"}async function renderProducts(){const e=document.getElementById("products-list");if(e){console.log("Rendering products..."),e.innerHTML='<div class="loading">Loading products...</div>';try{if("undefined"==typeof db)throw new Error("Firebase not initialized");const t=await getProductsFromFirebase();if(console.log("Products loaded:",t.length),0===t.length)return void(e.innerHTML='<div class="empty-state"><p>No products yet. Click "Add Product" to create one.</p></div>');e.innerHTML=t.map(e=>`\n            <div class="admin-item ${e.hidden?"hidden-item":""}" data-id="${e.id}">\n                <div class="admin-item-content">\n                    <h3>${e.name}</h3>\n                    ${e.image?`<img src="${e.image}" alt="${e.name}" style="max-width: 200px; margin: 10px 0; border-radius: 8px;">`:""}\n                    <p>${e.description}</p>\n                    <div class="admin-item-meta">\n                        <span><strong>Price:</strong> ${e.price}</span>\n                    </div>\n                </div>\n                <div class="admin-item-actions">\n                    <button class="btn-toggle" onclick="toggleProductVisibility('${e.id}')">\n                        ${e.hidden?"üëÅÔ∏è Show":"üôà Hide"}\n                    </button>\n                    <button class="btn-edit" onclick="editProduct('${e.id}')">Edit</button>\n                    <button class="btn-delete" onclick="deleteProduct('${e.id}')">Delete</button>\n                </div>\n            </div>\n        `).join("")}catch(t){console.error("Error rendering products:",t),console.error("Error details:",t.message),e.innerHTML=`<div class="empty-state"><p>Error loading products: ${t.message}</p><p>Check console for details.</p></div>`}}else console.error("Products list container not found")}async function renderBlogPosts(){const e=document.getElementById("blog-list");if(e){console.log("Rendering blog posts..."),e.innerHTML='<div class="loading">Loading blog posts...</div>';try{if("undefined"==typeof db)throw new Error("Firebase not initialized");const t=await getBlogPostsFromFirebase();if(console.log("Blog posts loaded:",t.length),0===t.length)return void(e.innerHTML='<div class="empty-state"><p>No blog posts yet. Click "Add New Post" to create one.</p></div>');e.innerHTML=t.map(e=>`\n            <div class="admin-item ${e.hidden?"hidden-item":""}" data-id="${e.id}">\n                <div class="admin-item-content">\n                    <h3>${e.title}</h3>\n                    ${e.image?`<img src="${e.image}" alt="${e.title}" style="max-width: 200px; margin: 10px 0; border-radius: 8px;">`:""}\n                    <p>${e.excerpt}</p>\n                    <div class="admin-item-meta">\n                        <span><strong>Date:</strong> ${e.date}</span>\n                    </div>\n                </div>\n                <div class="admin-item-actions">\n                    <button class="btn-toggle" onclick="toggleBlogPostVisibility('${e.id}')">\n                        ${e.hidden?"üëÅÔ∏è Show":"üôà Hide"}\n                    </button>\n                    <button class="btn-edit" onclick="editBlogPost('${e.id}')">Edit</button>\n                    <button class="btn-delete" onclick="deleteBlogPost('${e.id}')">Delete</button>\n                </div>\n            </div>\n        `).join("")}catch(t){console.error("Error rendering blog posts:",t),console.error("Error details:",t.message),e.innerHTML=`<div class="empty-state"><p>Error loading posts: ${t.message}</p><p>Check console for details.</p></div>`}}else console.error("Blog list container not found")}function openProductModal(){document.getElementById("product-form").reset(),document.getElementById("product-id").value="",document.getElementById("product-image-preview").innerHTML="",document.getElementById("product-image-preview").classList.remove("active"),document.getElementById("product-modal-title").textContent="Add New Product",document.getElementById("product-modal").classList.add("active")}function closeProductModal(){document.getElementById("product-modal").classList.remove("active")}async function saveProduct(e){e.preventDefault();const t=document.getElementById("product-id").value,o=document.getElementById("product-name").value,n=document.getElementById("product-description").value,d=document.getElementById("product-price").value,i=document.getElementById("product-image").files[0];try{let e="";if(i)e=await uploadImageToFirebase(i,"products");else if(t){const o=(await getProductsFromFirebase()).find(e=>e.id===t);e=o?.image||""}const s={id:t||Date.now().toString(),name:o,description:n,price:d,image:e,hidden:!1};await saveProductToFirebase(s),await renderProducts(),closeProductModal(),showToast("Product saved successfully!","success")}catch(e){console.error("Error saving product:",e),showToast("Error saving product. Please try again.","error")}}async function editProduct(e){try{const t=(await getProductsFromFirebase()).find(t=>t.id===e);if(t){document.getElementById("product-id").value=t.id,document.getElementById("product-name").value=t.name,document.getElementById("product-description").value=t.description,document.getElementById("product-price").value=t.price;const e=document.getElementById("product-image-preview");t.image&&(e.innerHTML=`<img src="${t.image}" alt="Current image">`,e.classList.add("active")),document.getElementById("product-modal-title").textContent="Edit Product",document.getElementById("product-modal").classList.add("active")}}catch(e){console.error("Error editing product:",e),showToast("Error loading product. Please try again.","error")}}async function deleteProduct(e){if(confirm("Are you sure you want to delete this product?"))try{await deleteProductFromFirebase(e),await renderProducts(),showToast("Product deleted successfully!","success")}catch(e){console.error("Error deleting product:",e),showToast("Error deleting product. Please try again.","error")}}async function toggleProductVisibility(e){try{const t=(await getProductsFromFirebase()).find(t=>t.id===e);t&&(t.hidden=!t.hidden,await saveProductToFirebase(t),await renderProducts(),showToast(`Product ${t.hidden?"hidden":"shown"} successfully!`,"success"))}catch(e){console.error("Error toggling visibility:",e),showToast("Error updating product. Please try again.","error")}}function openBlogModal(){document.getElementById("blog-form").reset(),document.getElementById("blog-id").value="",document.getElementById("blog-image-preview").innerHTML="",document.getElementById("blog-image-preview").classList.remove("active"),document.getElementById("blog-modal-title").textContent="Add New Blog Post",document.getElementById("blog-modal").classList.add("active")}function closeBlogModal(){document.getElementById("blog-modal").classList.remove("active")}async function saveBlogPost(e){e.preventDefault();const t=document.getElementById("blog-id").value,o=document.getElementById("blog-title").value,n=document.getElementById("blog-excerpt").value,d=document.getElementById("blog-content").value,i=document.getElementById("blog-date").value,s=document.getElementById("blog-image").files[0];try{let e="";if(s)e=await uploadImageToFirebase(s,"blog");else if(t){const o=(await getBlogPostsFromFirebase()).find(e=>e.id===t);e=o?.image||""}const r={id:t||Date.now().toString(),title:o,excerpt:n,content:d,date:i,author:"Admin",image:e,hidden:!1};await saveBlogPostToFirebase(r),await renderBlogPosts(),closeBlogModal(),showToast("Blog post saved successfully!","success")}catch(e){console.error("Error saving blog post:",e),showToast("Error saving blog post. Please try again.","error")}}async function editBlogPost(e){try{const t=(await getBlogPostsFromFirebase()).find(t=>t.id===e);if(t){document.getElementById("blog-id").value=t.id,document.getElementById("blog-title").value=t.title,document.getElementById("blog-excerpt").value=t.excerpt,document.getElementById("blog-content").value=t.content||"",document.getElementById("blog-date").value=t.date;const e=document.getElementById("blog-image-preview");t.image&&(e.innerHTML=`<img src="${t.image}" alt="Current image">`,e.classList.add("active")),document.getElementById("blog-modal-title").textContent="Edit Blog Post",document.getElementById("blog-modal").classList.add("active")}}catch(e){console.error("Error editing blog post:",e),showToast("Error loading blog post. Please try again.","error")}}async function deleteBlogPost(e){if(confirm("Are you sure you want to delete this blog post?"))try{await deleteBlogPostFromFirebase(e),await renderBlogPosts(),showToast("Blog post deleted successfully!","success")}catch(e){console.error("Error deleting blog post:",e),showToast("Error deleting blog post. Please try again.","error")}}async function toggleBlogPostVisibility(e){try{const t=(await getBlogPostsFromFirebase()).find(t=>t.id===e);t&&(t.hidden=!t.hidden,await saveBlogPostToFirebase(t),await renderBlogPosts(),showToast(`Blog post ${t.hidden?"hidden":"shown"} successfully!`,"success"))}catch(e){console.error("Error toggling visibility:",e),showToast("Error updating blog post. Please try again.","error")}}function showToast(e,t="info"){"function"==typeof window.showToast?window.showToast(e,t):alert(e)}document.addEventListener("DOMContentLoaded",function(){if(console.log("üöÄ DOMContentLoaded fired - Admin dashboard initializing..."),"function"==typeof isAuthenticated&&!isAuthenticated())return console.log("‚ùå Not authenticated, redirecting..."),void(window.location.href="admin.html");console.log("‚úÖ User authenticated");const e=document.getElementById("product-image");e&&e.addEventListener("change",function(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=function(e){const t=document.getElementById("product-image-preview");t.innerHTML=`<img src="${e.target.result}" alt="Preview">`,t.classList.add("active")},e.readAsDataURL(t)}});const t=document.getElementById("blog-image");t&&t.addEventListener("change",function(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=function(e){const t=document.getElementById("blog-image-preview");t.innerHTML=`<img src="${e.target.result}" alt="Preview">`,t.classList.add("active")},e.readAsDataURL(t)}}),document.querySelectorAll(".admin-nav-links a").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),document.querySelectorAll(".admin-nav-links a").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".admin-section").forEach(e=>e.classList.remove("active")),this.classList.add("active");const t=this.getAttribute("data-tab"),o=document.getElementById(t);if(o)if(o.classList.add("active"),"products-section"===t){console.log("Switching to products section");const e=document.getElementById("products-list");e?(console.log("Products container found, showing loading..."),e.innerHTML='<div class="loading">Loading products...</div>',renderProducts()):console.error("Products container NOT found!")}else if("blog-section"===t){console.log("Switching to blog section");const e=document.getElementById("blog-list");e?(console.log("Blog container found, showing loading..."),e.innerHTML='<div class="loading">Loading blog posts...</div>',renderBlogPosts()):console.error("Blog container NOT found!")}else"comments-section"===t&&(console.log("Switching to comments section"),"function"==typeof window.loadAdminComments&&window.loadAdminComments())})});const o=document.getElementById("product-form");o&&o.addEventListener("submit",saveProduct);const n=document.getElementById("blog-form");n&&n.addEventListener("submit",saveBlogPost);const d=document.getElementById("add-product-btn");d&&d.addEventListener("click",openProductModal);const i=document.getElementById("add-blog-btn");i&&i.addEventListener("click",openBlogModal),document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",function(){this.closest(".modal").classList.remove("active")})}),console.log("Initializing admin dashboard..."),renderProducts(),renderBlogPosts();document.getElementById("comments-section")&&console.log("Comments section found")});